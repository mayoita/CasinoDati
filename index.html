<html>
<head>
<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCfL1j_9u08QuliNtt-zij9zc8htgwtvpY"></script>
<!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
     <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/data.js"></script>
<div><wpt lat="45.442989" lon="12.329876"></div>



<div class="container-fluid">
    <div class="row">
      <div class="col-md-3">
          <div class="input-group">
            <span class="input-group-addon">Km</span>
            <input type="number" class="form-control" placeholder="Km..." id="mainText" onchange="play()" value="10">
            <span class="input-group-btn">
              <button class="btn btn-secondary" type="button" onclick="hideFour()">Singolo</button>
              <button class="btn btn-secondary" type="button" onclick="hideSingle()">Multiplo</button>
            </span>
          </div>
      </div>
      <div class="col-md-9">
        <input type="number" ></input>
        <button id="submitBtn" onclick="submitClick()"><i class="fa fa-arrow-right" aria-hidden="true"></i></button>
      </div>
      <div class="col-md-12" id="maptest" style="width:100%;height:100%;"></div>
    </div>
    
  </div>
   <script>    

      Number.prototype.toRad = function() {
         return this * Math.PI / 180;
      }

      Number.prototype.toDeg = function() {
         return this * 180 / Math.PI;
      }

      google.maps.LatLng.prototype.destinationPoint = function(brng, dist) {
         dist = dist / 6371;  
         brng = brng.toRad();  

         var lat1 = this.lat().toRad(), lon1 = this.lng().toRad();

         var lat2 = Math.asin(Math.sin(lat1) * Math.cos(dist) + 
                              Math.cos(lat1) * Math.sin(dist) * Math.cos(brng));

         var lon2 = lon1 + Math.atan2(Math.sin(brng) * Math.sin(dist) *
                                      Math.cos(lat1), 
                                      Math.cos(dist) - Math.sin(lat1) *
                                      Math.sin(lat2));

         if (isNaN(lat2) || isNaN(lon2)) return null;

         return new google.maps.LatLng(lat2.toDeg(), lon2.toDeg());
      }
      
      var CaVendramin = new google.maps.LatLng(45.442989, 12.329876);
      var mapOptions = {
        scrollwheel: true,
        zoom: 7,
        center: CaVendramin
      };
         
      var map = new google.maps.Map(
          document.getElementById('maptest'),
          mapOptions
      );

      var marker1 = new google.maps.Marker({
          map: map, 
          position: new google.maps.LatLng(45.442989, 12.329876)
      });

      var circleS = new google.maps.Circle({
        map: map,
        radius: 10000,
        fillColor: '#ff0000',
        fillOpacity: 0.35,
        strokeWeight: 0,
        editable: true,
        });

      // Add an event listener on the rectangle.
        circleS.addListener('bounds_changed', showNewRect);
        
        // Define an info window on the map.
        infoWindow = new google.maps.InfoWindow();

        /** @this {google.maps.Rectangle} */
      function showNewRect(event) {
        var ne = circleS.getBounds().getNorthEast() ;
        var mainText = document.getElementById("mainText");

        var totale = 0;

         for (var city in provVE) {
          // Add the circle for this city to the map.
          var b = provVE[city].center;
          var a = new google.maps.LatLng(parseFloat(b.lat), parseFloat(b.lng));

          if (google.maps.geometry.spherical.computeDistanceBetween(a, circleS.getCenter()) <= (circleS.getRadius())) {
                console.log(city + '=> is in searchArea');
                totale = totale + Number(provVE[city].population);
            } 
        }   
        var contentString = '<b>Totale</b><br>' +
            'Ingressi: ' + totale;

        // Set the info window's content and position.
        infoWindow.setContent(contentString);
        infoWindow.setPosition(CaVendramin.destinationPoint(0, Number(mainText.value)));
        infoWindow.open(map);
      }

       var circle = new google.maps.Circle({
        map: map,
        radius: 10000,
        fillColor: '#ff0000',
        fillOpacity: 0.15,
        strokeWeight: 0,
        });

       var circle2 = new google.maps.Circle({
        map: map,
        radius: 40000,
        fillColor: '#ff0000',
        fillOpacity: 0.15,
        strokeWeight: 0,
        });

       var circle3 = new google.maps.Circle({
        map: map,
        radius: 60000,
        fillColor: '#ff0000',
        fillOpacity: 0.15,
        strokeWeight: 0,
        });

       var circle4 = new google.maps.Circle({
        map: map,
        radius: 80000,
        fillColor: '#ff0000',
        fillOpacity: 0.15,
        strokeWeight: 0,
        });

       var circle5 = new google.maps.Circle({
        map: map,
        radius: 100000,
        fillColor: '#ff0000',
        fillOpacity: 0.15,
        strokeWeight: 0,
        });

       function hideFour() {
  circle.setMap(null);
  circle2.setMap(null);
  circle3.setMap(null);
  circle4.setMap(null);
  circle5.setMap(null);
  circleS.setMap(map);
  circleS.bindTo('center', marker1, 'position');
  play();
}

function hideSingle() {
  circle.setMap(map);
  circle2.setMap(map);
  circle3.setMap(map);
  circle4.setMap(map);
  circle5.setMap(map);
  circle.bindTo('center', marker1, 'position');
  circle2.bindTo('center', marker1, 'position');
  circle3.bindTo('center', marker1, 'position');
  circle4.bindTo('center', marker1, 'position');
  circle5.bindTo('center', marker1, 'position');
  circleS.setMap(null);
  playS();
}
     


  // Construct the circle for each value in citymap.
        // Note: We scale the area of the circle based on the population.
        for (var city in citymap) {
          // Add the circle for this city to the map.
          var cityCircle = new google.maps.Circle({
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            strokeWeight: 1,
            fillColor: '#2058FF',
            fillOpacity: 0.35,
            map: map,
            center: citymap[city].center,
            radius: Math.sqrt(citymap[city].population) * 500
          });
        }

        for (var city in provVE) {
          // Add the circle for this city to the map.
          var cityCircle = new google.maps.Circle({
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            strokeWeight: 1,
            fillColor: '#2058FF',
            fillOpacity: 0.35,
            map: map,
            center: provVE[city].center,
            radius: Math.sqrt(provVE[city].population) * 500
          });
        }
        for (var city in provTV) {
          // Add the circle for this city to the map.
          var cityCircle = new google.maps.Circle({
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            strokeWeight: 1,
            fillColor: '#2058FF',
            fillOpacity: 0.35,
            map: map,
            center: provTV[city].center,
            radius: Math.sqrt(provTV[city].population) * 500
          });
        }
      for (var city in provPD) {
          // Add the circle for this city to the map.
          var cityCircle = new google.maps.Circle({
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            strokeWeight: 1,
            fillColor: '#2058FF',
            fillOpacity: 0.35,
            map: map,
            center: provPD[city].center,
            radius: Math.sqrt(provPD[city].population) * 500
          });
        }
        for (var city in provVR) {
          // Add the circle for this city to the map.
          var cityCircle = new google.maps.Circle({
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            strokeWeight: 1,
            fillColor: '#2058FF',
            fillOpacity: 0.35,
            map: map,
            center: provVR[city].center,
            radius: Math.sqrt(provVR[city].population) * 500
          });
        }
        for (var city in provVI) {
          // Add the circle for this city to the map.
          var cityCircle = new google.maps.Circle({
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            strokeWeight: 1,
            fillColor: '#2058FF',
            fillOpacity: 0.35,
            map: map,
            center: provVI[city].center,
            radius: Math.sqrt(provVI[city].population) * 500
          });
        }
        for (var city in provBL) {
          // Add the circle for this city to the map.
          var cityCircle = new google.maps.Circle({
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            strokeWeight: 1,
            fillColor: '#2058FF',
            fillOpacity: 0.35,
            map: map,
            center: provBL[city].center,
            radius: Math.sqrt(provBL[city].population) * 500
          });
        }
        for (var city in provRO) {
          // Add the circle for this city to the map.
          var cityCircle = new google.maps.Circle({
            strokeColor: '#FF0000',
            strokeOpacity: 0.8,
            strokeWeight: 1,
            fillColor: '#2058FF',
            fillOpacity: 0.35,
            map: map,
            center: provRO[city].center,
            radius: Math.sqrt(provRO[city].population) * 500
          });
        }

        function play(){
          var mainText = document.getElementById("mainText");
          circleS.setRadius(Number(mainText.value) * 1000);
          
          map.fitBounds(circleS.getBounds());
         
        }

        function playS(){
          var mainText = document.getElementById("mainText");
          circle.setRadius(Number(mainText.value) * 1000);
          circle2.setRadius(Number(mainText.value) * 2000);
          circle3.setRadius(Number(mainText.value) * 3000);
          circle4.setRadius(Number(mainText.value) * 4000);
          circle5.setRadius(Number(mainText.value) * 5000);
         
          map.fitBounds(circle5.getBounds());
         
        }


   </script>
   <script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script>

</body>
</html>